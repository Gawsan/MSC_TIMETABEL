<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gawsan â€¢ Semester 3 Timetable</title>
    <meta name="theme-color" content="#0ea5e9" />
    <meta
      name="description"
      content="Personal class timetable for Semester 3, Intake 2025."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      :root {
        --bg: #0b1220;
        --card: #0f172a;
        --muted: #94a3b8;
        --text: #e2e8f0;
        --brand: #38bdf8;
        --brand-2: #818cf8;
        --good: #22c55e;
        --warn: #f59e0b;
        --bad: #ef4444;
        --glass: rgba(255, 255, 255, 0.06);
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        --radius: 18px;
        --transition: all 0.3s ease;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
        scroll-behavior: smooth;
      }
      body {
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text);
        background: radial-gradient(
            1200px 600px at 80% -10%,
            rgba(56, 189, 248, 0.25),
            transparent
          ),
          radial-gradient(
            900px 500px at -10% 20%,
            rgba(129, 140, 248, 0.25),
            transparent
          ),
          var(--bg);
        overflow-x: hidden;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(20px);
        background: linear-gradient(
          180deg,
          rgba(11, 18, 32, 0.95),
          rgba(11, 18, 32, 0.7)
        );
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        transition: var(--transition);
      }
      header:hover {
        background: linear-gradient(
          180deg,
          rgba(11, 18, 32, 0.98),
          rgba(11, 18, 32, 0.85)
        );
      }
      .hero {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        padding: 20px 0;
        animation: fadeInDown 1s ease-out;
      }
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 999px;
        background: var(--glass);
        font-size: 13px;
        color: var(--muted);
        transition: var(--transition);
      }
      .badge:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      .title {
        font-weight: 800;
        letter-spacing: 0.1em;
        font-size: clamp(24px, 4vw, 36px);
        margin: 0;
      }
      .subtitle {
        margin: 6px 0 0;
        color: var(--muted);
        font-size: 14px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-top: 32px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.04)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        animation: fadeInUp 0.5s ease-out forwards;
        opacity: 0;
      }
      .card:nth-child(1) {
        animation-delay: 0.1s;
      }
      .card:nth-child(2) {
        animation-delay: 0.2s;
      }
      .card:nth-child(3) {
        animation-delay: 0.3s;
      }
      .card:nth-child(4) {
        animation-delay: 0.4s;
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        border-color: rgba(255, 255, 255, 0.15);
      }
      .day {
        font-size: 13px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.15em;
      }
      .time {
        font-size: 15px;
        color: #cbd5e1;
        margin-top: 4px;
      }
      .code {
        font-weight: 700;
        color: #a5b4fc;
      }
      .title-sm {
        font-weight: 700;
        font-size: 18px;
        margin: 8px 0 10px;
      }
      .lect {
        font-size: 14px;
        color: var(--muted);
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .lect::before {
        content: "\f007";
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        color: var(--brand);
        font-size: 12px;
      }
      .row {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }
      .btn {
        appearance: none;
        border: none;
        cursor: pointer;
        border-radius: 12px;
        padding: 10px 16px;
        font-weight: 600;
        color: #0b1220;
        background: linear-gradient(135deg, var(--brand), var(--brand-2));
        box-shadow: var(--shadow);
        transition: var(--transition);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 12px 30px rgba(56, 189, 248, 0.3);
      }
      .btn.secondary {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.16);
        color: var(--text);
      }
      .btn.secondary:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: scale(1.05);
      }
      .btn.small {
        padding: 8px 12px;
        font-size: 14px;
        border-radius: 10px;
      }
      .chip {
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(34, 197, 94, 0.18);
        color: #86efac;
        font-size: 13px;
        border: 1px solid rgba(34, 197, 94, 0.35);
        transition: var(--transition);
      }
      .chip:hover {
        background: rgba(34, 197, 94, 0.25);
      }
      .warn {
        background: rgba(245, 158, 11, 0.18);
        color: #fde68a;
        border-color: rgba(245, 158, 11, 0.4);
      }
      .muted {
        color: var(--muted);
      }
      .footer {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(11, 18, 32, 0.1),
          rgba(11, 18, 32, 0.9)
        );
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        transition: var(--transition);
      }
      .footer-inner {
        max-width: 1200px;
        margin: auto;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        flex-wrap: wrap;
        font-size: 14px;
        color: var(--muted);
      }
      .footer a {
        color: var(--brand);
        text-decoration: none;
        transition: var(--transition);
      }
      .footer a:hover {
        color: var(--brand-2);
      }
      .toast {
        position: fixed;
        right: 20px;
        bottom: 90px;
        background: #111827;
        color: #f9fafb;
        border: 1px solid rgba(255, 255, 255, 0.14);
        padding: 16px 20px;
        border-radius: 14px;
        box-shadow: var(--shadow);
        display: none;
        animation: slideInRight 0.5s ease-out;
      }
      @keyframes slideInRight {
        from {
          opacity: 0;
          transform: translateX(50px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .switch {
        position: relative;
        width: 48px;
        height: 28px;
        background: #334155;
        border-radius: 999px;
        cursor: pointer;
        display: inline-block;
        transition: var(--transition);
      }
      .switch i {
        position: absolute;
        top: 4px;
        left: 4px;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 999px;
        transition: var(--transition);
      }
      .switch[data-on="true"] {
        background: #22c55e;
      }
      .switch[data-on="true"] i {
        left: 24px;
      }
      .legend {
        font-size: 13px;
        color: var(--muted);
      }
      a.zoom {
        color: #93c5fd;
        transition: var(--transition);
      }
      a.zoom:hover {
        color: #60a5fa;
      }
      .tba {
        opacity: 0.85;
      }
      /* Media Queries for better responsiveness */
      @media (max-width: 600px) {
        .hero {
          flex-direction: column;
          align-items: flex-start;
        }
        .grid {
          grid-template-columns: 1fr;
        }
        .footer-inner {
          flex-direction: column;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container hero">
        <div>
          <div class="badge">
            <i class="fas fa-calendar-alt"></i> Semester 3 â€¢ Intake 2025 â€¢ Sept
            6 â†’ Nov 22
          </div>
          <h1 class="title">Gawsan â€“ Personal Class Timetable</h1>
        </div>
        <nav class="row">
          <a href="#cards" class="btn small secondary"
            ><i class="fas fa-clock"></i> View Schedule</a
          >
        </nav>
      </div>
    </header>

    <main class="container">
      <section class="grid" id="cards"></section>

      <div class="toast" id="toast"></div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        <span>Â© 2025 Gawsan. All rights reserved.</span>
        <div class="row">
          <a
            href="https://github.com/yourusername/yourrepo"
            target="_blank"
            rel="noreferrer"
            ><i class="fab fa-github"></i> GitHub</a
          >
          <a href="mailto:your.email@example.com"
            ><i class="fas fa-envelope"></i> Contact</a
          >
        </div>
      </div>
    </footer>

    <audio id="ding" preload="auto">
      <source
        src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAAAACAAACQwAABpYb3MAAAABAAAALAAAAG1wMyBMYW1lMGEA..."
        type="audio/mp3"
      />
    </audio>

    <script>
      // --- Data ----------------------------------------------------
      const SEMESTER_START = new Date("2025-09-06T00:00:00");
      const SEMESTER_END = new Date("2025-11-22T23:59:59");

      // Your enrolled modules (excluding TBA for grid)
      const classes = [
        {
          id: "CS5213",
          day: "Saturday",
          start: "08:00",
          end: "10:30",
          code: "CS5213",
          title: "Enterprise Software Architecture",
          lecturer: "Prof. Indika Perera",
          zoom: null,
        },
        {
          id: "CS5999",
          day: "Saturday",
          start: "14:00",
          end: "15:00",
          code: "CS5999",
          title: "PG Dip Project",
          lecturer: "Dr. Nisansa / Prof. Dulani / Dr. Charith",
          zoom: "https://learn.zoom.us/j/99113914633?pwd=LcCKRNyg9dS9kdMvW2QOgLrUMADL6X.1&jst=2",
        },
        {
          id: "CS5243",
          day: "Tuesday",
          start: "19:00",
          end: "21:30",
          code: "CS5243",
          title: "Client Side Application Development",
          lecturer: "Dr. Buddhika Karunarathne",
          zoom: "https://learn.zoom.us/j/97884683504?pwd=wtLmTa194yuDuZtljI43A7u8p5tZ5j.1",
        },
        {
          id: "CS5618",
          day: "Thursday",
          start: "19:00",
          end: "21:30",
          code: "CS5618",
          title: "Business Intelligence",
          lecturer: "Dr. Thanuja Ambegoda",
          zoom: null,
        },
      ];

      const tba = {
        id: "CS5701",
        code: "CS5701",
        title: "Advanced Algorithms",
        lecturer: "Prof. Sanath Jayasena / Dr. Adeesha Wijayasiri",
      };

      // Helpers
      const dayIndex = {
        Sunday: 0,
        Monday: 1,
        Tuesday: 2,
        Wednesday: 3,
        Thursday: 4,
        Friday: 5,
        Saturday: 6,
      };
      function timeToHM(str) {
        const [h, m] = str.split(":").map(Number);
        return { h, m };
      }
      function nextOccurrenceFor(cls, from = new Date()) {
        // Next class date (>= now) within the semester window
        const targetDow = dayIndex[cls.day];
        let d = new Date(from);
        d.setSeconds(0, 0);
        // Move to start of day
        d.setHours(0, 0, 0, 0);
        const diff = (targetDow - d.getDay() + 7) % 7; // days to target
        d.setDate(d.getDate() + diff);
        const { h, m } = timeToHM(cls.start);
        d.setHours(h, m, 0, 0);
        if (d < from) {
          d.setDate(d.getDate() + 7);
        }
        // Ensure within semester
        if (d < SEMESTER_START) {
          // jump to first semester week on correct DOW
          const s = new Date(SEMESTER_START);
          const bump = (targetDow - s.getDay() + 7) % 7;
          s.setDate(s.getDate() + bump);
          s.setHours(h, m, 0, 0);
          d = s;
        }
        if (d > SEMESTER_END) return null;
        return d;
      }

      function toGoogleCalendarLink(cls) {
        const start = nextOccurrenceFor(cls);
        if (!start) return "#";
        const [eh, em] = cls.end.split(":").map(Number);
        const end = new Date(start);
        end.setHours(eh, em, 0, 0);
        function fmt(dt) {
          // YYYYMMDDTHHMMSS in local time (Google interprets as local)
          const pad = (n) => String(n).padStart(2, "0");
          return `${dt.getFullYear()}${pad(dt.getMonth() + 1)}${pad(
            dt.getDate()
          )}T${pad(dt.getHours())}${pad(dt.getMinutes())}00`;
        }
        const text = encodeURIComponent(`${cls.code} â€“ ${cls.title}`);
        const details = encodeURIComponent(
          cls.lecturer + (cls.zoom ? `\nZoom: ${cls.zoom}` : "")
        );
        const location = encodeURIComponent(cls.zoom ? "Zoom" : "");
        return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&details=${details}&location=${location}&dates=${fmt(
          start
        )}/${fmt(end)}`;
      }

      // --- UI render ----------------------------------------------
      const cardsEl = document.getElementById("cards");

      function stored(key, fallback) {
        try {
          return JSON.parse(localStorage.getItem(key)) ?? fallback;
        } catch (e) {
          return fallback;
        }
      }
      function store(key, value) {
        localStorage.setItem(key, JSON.stringify(value));
      }

      function render() {
        cardsEl.innerHTML = "";

        classes.forEach((cls) => {
          const reminderKey = `reminder:${cls.id}`;
          const advanceKey = `advance:${cls.id}`;
          const enabled = stored(reminderKey, false);
          const advance = stored(advanceKey, 10); // minutes
          const next = nextOccurrenceFor(cls);

          const card = document.createElement("article");
          card.className = "card";
          card.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-start">
          <div>
            <div class="day"><i class="fas fa-calendar-day"></i> ${
              cls.day
            }</div>
            <div class="time"><i class="fas fa-clock"></i> ${cls.start} â€“ ${
            cls.end
          }</div>
          </div>
          <div class="row">
            <span class="chip ${next ? "" : "warn"}">${
            next ? "Next: " + next.toLocaleString() : "Out of semester"
          }</span>
          </div>
        </div>
        <div class="title-sm"><span class="code">${cls.code}</span> â€¢ ${
            cls.title
          }</div>
        <div class="lect">${cls.lecturer}</div>
        <div class="row" style="margin-top:16px">
          ${
            cls.zoom
              ? `<a class="btn small" href="${cls.zoom}" target="_blank" rel="noreferrer"><i class="fas fa-video"></i> Join Zoom</a>`
              : ""
          }
          <a class="btn small secondary" href="${toGoogleCalendarLink(
            cls
          )}" target="_blank" rel="noreferrer"><i class="fas fa-calendar-plus"></i> Add to Calendar</a>
          <label class="row" style="gap:8px; align-items:center">
            <span class="legend">Alert:</span>
            <select data-id="${
              cls.id
            }" class="advance" style="background:#0b1220;border:1px solid rgba(255,255,255,.16);color:var(--text);border-radius:10px;padding:8px 12px">
              ${[5, 10, 15, 30, 60]
                .map(
                  (n) =>
                    `<option ${
                      n === advance ? "selected" : ""
                    } value="${n}">${n} min before</option>`
                )
                .join("")}
            </select>
          </label>
          <div class="switch" role="switch" aria-label="Reminder" data-on="${enabled}" data-id="${
            cls.id
          }"><i></i></div>
        </div>
      `;
          cardsEl.appendChild(card);
        });

        // TBA card
        const t = document.createElement("article");
        t.className = "card tba";
        t.innerHTML = `
      <div class="day"><i class="fas fa-question-circle"></i> TBA</div>
      <div class="title-sm"><span class="code">${tba.code}</span> â€¢ ${tba.title}</div>
      <div class="lect">${tba.lecturer}</div>
      <div class="row" style="margin-top:16px"><span class="chip warn">Time to be announced</span></div>
    `;
        cardsEl.appendChild(t);
      }

      render();

      // --- Reminder engine ----------------------------------------
      const toast = document.getElementById("toast");
      function showToast(msg) {
        toast.textContent = msg;
        toast.style.display = "block";
        clearTimeout(showToast._t);
        showToast._t = setTimeout(() => (toast.style.display = "none"), 4500);
      }

      async function ensurePermission() {
        if (!("Notification" in window)) {
          showToast("Notifications not supported");
          return false;
        }
        if (Notification.permission === "granted") return true;
        if (Notification.permission !== "denied") {
          const res = await Notification.requestPermission();
          return res === "granted";
        }
        return false;
      }

      function notify(cls) {
        const audio = document.getElementById("ding");
        try {
          audio.currentTime = 0;
          audio.play().catch(() => {});
        } catch (e) {}
        const body = `${cls.day} ${cls.start} â€“ ${cls.end}\n${cls.code} â€¢ ${cls.title}`;
        if ("Notification" in window && Notification.permission === "granted") {
          const n = new Notification("Class starting soon", { body });
          if (cls.zoom) {
            n.onclick = () => window.open(cls.zoom, "_blank");
          }
        } else {
          showToast("Class soon: " + body);
        }
      }

      function scheduleLoop() {
        const now = new Date();
        classes.forEach((cls) => {
          const enabled = JSON.parse(
            localStorage.getItem(`reminder:${cls.id}`) || "false"
          );
          if (!enabled) return;
          const advance = parseInt(
            localStorage.getItem(`advance:${cls.id}`) || "10",
            10
          );
          const next = nextOccurrenceFor(cls, now);
          if (!next) return;
          const alertAt = new Date(next.getTime() - advance * 60 * 1000);
          const windowMs = 30 * 1000; // 30s window
          const lastKey = `lastNotified:${cls.id}`;
          const tag = `${next.toISOString()}-${advance}`;
          const already = localStorage.getItem(lastKey) === tag;
          if (
            !already &&
            now >= alertAt &&
            now <= new Date(alertAt.getTime() + windowMs)
          ) {
            localStorage.setItem(lastKey, tag);
            notify(cls);
          }
        });
      }

      setInterval(scheduleLoop, 15000); // check every 15s

      // --- Interactions -------------------------------------------
      document.addEventListener("click", (e) => {
        const sw = e.target.closest(".switch");
        if (!sw) return;
        const id = sw.dataset.id;
        const on = sw.getAttribute("data-on") === "true";
        const next = !on;
        sw.setAttribute("data-on", String(next));
        localStorage.setItem(`reminder:${id}`, JSON.stringify(next));
        if (next) ensurePermission();
      });

      document.addEventListener("change", (e) => {
        if (e.target.matches("select.advance")) {
          const id = e.target.getAttribute("data-id");
          const val = parseInt(e.target.value, 10);
          localStorage.setItem(`advance:${id}`, String(val));
          showToast(`Reminder set to ${val} min before`);
        }
      });
    </script>
  </body>
</html>
